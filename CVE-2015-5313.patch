Index: libvirt-1.2.12/src/storage/storage_backend_fs.c
===================================================================
--- libvirt-1.2.12.orig/src/storage/storage_backend_fs.c        2015-01-23 11:46:24.000000000 +0000
+++ libvirt-1.2.12/src/storage/storage_backend_fs.c     2018-01-30 07:00:54.000000000 +0000
@@ -1,7 +1,7 @@
 /*
  * storage_backend_fs.c: storage backend for FS and directory handling
  *
- * Copyright (C) 2007-2014 Red Hat, Inc.
+ * Copyright (C) 2007-2015 Red Hat, Inc.
  * Copyright (C) 2007-2008 Daniel P. Berrange
  *
  * This library is free software; you can redistribute it and/or
@@ -1003,6 +1003,14 @@

     vol->type = VIR_STORAGE_VOL_FILE;

+    /* Volumes within a directory pools are not recursive; do not
+     * allow escape to ../ or a subdir */
+    if (strchr(vol->name, '/')) {
+        virReportError(VIR_ERR_OPERATION_INVALID,
+                       _("volume name '%s' cannot contain '/'"), vol->name);
+        return -1;
+    }
+
     VIR_FREE(vol->target.path);
     if (virAsprintf(&vol->target.path, "%s/%s",
                     pool->def->target.path,
